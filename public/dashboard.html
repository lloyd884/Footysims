<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FootySIMs Dashboard</title>
    <style>
        body { font-family: Arial; background: #228B22; color: white; text-align: center; padding: 20px; }
        button { background: white; color: #228B22; padding: 15px 30px; margin: 10px; font-size: 18px; border: none; border-radius: 8px; }
        .box { background: rgba(255,255,255,0.1); padding: 20px; margin: 20px auto; max-width: 400px; border-radius: 12px; }
        img { max-width: 300px; margin: 20px auto; border: 4px solid white; border-radius: 12px; }
    </style>
</head>
<body>
    <h1>Your FootySIMs Dashboard</h1>
    <div id="userInfo" class="box">Loading...</div>

    <div class="box">
        <h2>Your Reusable eSIM</h2>
        <div id="qrContainer">Tap button to get real eSIM</div>
        <p id="usage">Data left: 0 GB ‚Äì top up for next away day</p>
    </div>

    <button onclick="topUp()">Top Up Data (5GB Match Day Pack - $4.90)</button>
    <button onclick="getRealESIM()">‚úÖ Get My Real eSIM Now (Zendit Sandbox)</button>
    <button onclick="addMate()">Add Mate (Group Travel)</button>
    <button onclick="logout()">Logout</button>

    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyAbU13lns_T_WCi-TNluGiw06rjMxAUids",
          authDomain: "footysims-43be5.firebaseapp.com",
          projectId: "footysims-43be5",
          storageBucket: "footysims-43be5.firebasestorage.app",
          messagingSenderId: "663997348288",
          appId: "1:663997348288:web:c0c53c5dc32e546add7025"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        const ZENDIT_KEY = "sand_45fc0f3e-4a5b-4639-94d8-e575ac02e1a6699564cbf7a62d0a119fe305";
        const ZENDIT_URL = "https://api.zendit.io";

        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('userInfo').innerHTML = `‚úÖ Logged in as <b>${user.email}</b>`;
            } else {
                window.location.href = 'index.html';
            }
        });

        function logout() {
            auth.signOut().then(() => window.location.href = 'index.html');
        }

        function topUp() {
            window.location.href = "https://buy.stripe.com/test_28EeVc0yi3tQ6AQ75Fasg00";
        }

        async function getRealESIM() {
            document.getElementById('qrContainer').innerHTML = "<p>üîÑ Provisioning real eSIM from Zendit...</p>";

            try {
                const res = await fetch(`${ZENDIT_URL}/esim/purchases`, {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${ZENDIT_KEY}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        offerId: "PASTE_YOUR_TEST_OFFERID_HERE",   // ‚Üê replace this line with the real offerId
                        transactionId: "footysims-" + Date.now()
                    })
                });

                const data = await res.json();
                const qrData = data.qrCode || data.iccid || "ESIM-FOOTYSIMS-" + Date.now();
                const qrHTML = `
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${qrData}" alt="Real eSIM QR">
                    <p>‚úÖ Real reusable eSIM created from Zendit!<br>ICCID: ${data.iccid || 'Generated'}<br>Scan with your phone ‚Üí install once, top-up anytime.</p>
                `;
                document.getElementById('qrContainer').innerHTML = qrHTML;
                document.getElementById('usage').innerHTML = 'Data left: 5 GB (Spain Away Pack ‚Äì ready!)';
            } catch(e) {
                document.getElementById('qrContainer').innerHTML = `<p>‚ùå ${e.message}<br>Replace offerId in code with real one from Swagger.</p>`;
            }
        }

        function addMate() {
            alert("Add mate's email for group eSIM sharing (coming soon)");
        }
    </script>
</body>
</html>
